name: Website Monitor with Screenshot

on:
  schedule:
    # প্রতি ৮ ঘন্টা অন্তর চালাবে
    - cron: '0 */8 * * *' 
  workflow_dispatch: # ম্যানুয়ালি চালানোর অপশনও থাকবে

jobs:
  check-website:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install dependencies
        run: |
          sudo apt update
          sudo apt install -y chromium-browser chromium-chromedriver wget

      - name: Take screenshot of the website
        run: |
          mkdir -p screenshots
          # Using chromium to take screenshot
          chromium-browser --headless --disable-gpu --window-size=1280,720 --screenshot=screenshots/iptvpulse.png https://www.iptvpulse.top/
      
      - name: Upload screenshot as artifact
        uses: actions/upload-artifact@v3
        with:
          name: iptv-screenshot
          path: screenshots/iptvpulse.png

      - name: Check website status
        run: |
          HTTP_CODE=$(curl -o /dev/null -s -w "%{http_code}" https://www.iptvpulse.top/)
          echo "HTTP Status Code: $HTTP_CODE"
          if [ "$HTTP_CODE" -ne 200 ]; then
            echo "⚠️ Website is down or returned an error!"
            exit 1
          else
            echo "✅ Website is up and running."
          fi
